-- Speed control script (NO GUI / NO JumpPower)
-- Starts automatically on execution

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local player = Players.LocalPlayer

-- CONFIG
local jakcy = 49.9
local running = true
local renderConnection
local lastVelocity = Vector3.new(0, 0, 0)
local velocitySmoothness = 0.001
local updateVariance = 0.001
local lastUpdate = tick()

local function disconnectRender()
    if renderConnection then
        if renderConnection.Connected then
            renderConnection:Disconnect()
        end
        renderConnection = nil
    end
end

local function applyVelocity(char)
    disconnectRender()

    local humanoid = char:WaitForChild("Humanoid")
    local root = char:WaitForChild("HumanoidRootPart")

    lastVelocity = Vector3.new(0, 0, 0)
    lastUpdate = tick()

    renderConnection = RunService.RenderStepped:Connect(function()
        if not running or not humanoid or not root then return end

        local currentTime = tick()
        if currentTime - lastUpdate >= (0.1 + (math.random() * 2 - 1) * updateVariance) then
            lastUpdate = currentTime

            local direction = humanoid.MoveDirection or Vector3.new()
            if direction.Magnitude > 0 then
                local targetVelocity = Vector3.new(
                    direction.X * jakcy,
                    root.Velocity.Y,
                    direction.Z * jakcy
                )

                local newVelocity = lastVelocity * velocitySmoothness + targetVelocity * (1 - velocitySmoothness)
                lastVelocity = newVelocity

                root.Velocity = newVelocity
            else
                lastVelocity = Vector3.new(0, root.Velocity.Y, 0)
            end
        end
    end)
end

-- Start immediately
if player.Character then
    applyVelocity(player.Character)
end

player.CharacterAdded:Connect(function(char)
    if running then
        char:WaitForChild("Humanoid")
        applyVelocity(char)
    end
end)

player.CharacterRemoving:Connect(function()
    disconnectRender()
end)

-- watchdog: reapply if connection dies
spawn(function()
    while true do
        if running then
            if (not renderConnection) or (renderConnection and not renderConnection.Connected) then
                if player.Character then
                    applyVelocity(player.Character)
                end
            end
        end
        wait(5 + math.random() * 3)
    end
end)
